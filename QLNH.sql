USE master
GO
IF EXISTS(SELECT * FROM sysdatabases WHERE name='QLNH')
    DROP DATABASE QLNH;
GO
CREATE DATABASE QLNH;
GO
USE QLNH;
GO

CREATE TABLE CHINHANH (
    MaChiNhanh VARCHAR(10) NOT NULL,
    TenChiNhanh NVARCHAR(100) NOT NULL,
    DiaChi NVARCHAR(255),
    CONSTRAINT PK_CHINHANH PRIMARY KEY (MaChiNhanh)
);

CREATE TABLE KHACHHANG (
    MaKH VARCHAR(10) NOT NULL,
    TenKH NVARCHAR(100) NOT NULL,
    SDT VARCHAR(15),
    DiaChi NVARCHAR(255),
    CONSTRAINT PK_KHACHHANG PRIMARY KEY (MaKH)
);

CREATE TABLE LOAITAIKHOAN (
    MaLoaiTK VARCHAR(10) NOT NULL,
    TenLoaiTK NVARCHAR(100) NOT NULL,
    LaiSuat DECIMAL(5, 2) DEFAULT 0,
    CONSTRAINT PK_LOAITAIKHOAN PRIMARY KEY (MaLoaiTK)
);

CREATE TABLE LOAIGIAODICH (
    MaLoaiGD VARCHAR(10) NOT NULL,
    TenLoaiGD NVARCHAR(100) NOT NULL,
    CONSTRAINT PK_LOAIGIAODICH PRIMARY KEY (MaLoaiGD)
);

CREATE TABLE NHANVIENGIAODICH (
    MaNV VARCHAR(10) NOT NULL,
    TenNV NVARCHAR(100) NOT NULL,
    ViTri NVARCHAR(50),
    MaChiNhanh VARCHAR(10),
    CONSTRAINT PK_NHANVIENGIAODICH PRIMARY KEY (MaNV),
    CONSTRAINT FK_NHANVIEN_CHINHANH FOREIGN KEY (MaChiNhanh) REFERENCES CHINHANH(MaChiNhanh)
);

CREATE TABLE TAIKHOAN (
    MaTK VARCHAR(20) NOT NULL,
    SoDu DECIMAL(18, 2) DEFAULT 0,
    NgayMo DATE NOT NULL,
    MaKH VARCHAR(10) NOT NULL,
    MaChiNhanh VARCHAR(10),
    MaLoaiTK VARCHAR(10) NOT NULL,
    CONSTRAINT PK_TAIKHOAN PRIMARY KEY (MaTK),
    CONSTRAINT FK_TAIKHOAN_KHACHHANG FOREIGN KEY (MaKH) REFERENCES KHACHHANG(MaKH),
    CONSTRAINT FK_TAIKHOAN_CHINHANH FOREIGN KEY (MaChiNhanh) REFERENCES CHINHANH(MaChiNhanh),
    CONSTRAINT FK_TAIKHOAN_LOAITK FOREIGN KEY (MaLoaiTK) REFERENCES LOAITAIKHOAN(MaLoaiTK)
);

CREATE TABLE GIAODICH (
    MaGiaoDich VARCHAR(20) NOT NULL,
    NgayGD DATETIME NOT NULL,
    SoTien DECIMAL(18, 2) NOT NULL,
    MaNV VARCHAR(10),
    MaTK VARCHAR(20) NOT NULL,
    MaLoaiGD VARCHAR(10) NOT NULL,
    CONSTRAINT PK_GIAODICH PRIMARY KEY (MaGiaoDich),
    CONSTRAINT FK_GIAODICH_NHANVIEN FOREIGN KEY (MaNV) REFERENCES NHANVIENGIAODICH(MaNV),
    CONSTRAINT FK_GIAODICH_TAIKHOAN FOREIGN KEY (MaTK) REFERENCES TAIKHOAN(MaTK),
    CONSTRAINT FK_GIAODICH_LOAIGD FOREIGN KEY (MaLoaiGD) REFERENCES LOAIGIAODICH(MaLoaiGD)
);
GO

INSERT INTO CHINHANH (MaChiNhanh, TenChiNhanh, DiaChi)
VALUES
('CN001', N'Chi nhánh Hà Nội', N'191 Bà Triệu, Hai Bà Trưng, Hà Nội'),
('CN002', N'Chi nhánh TPHCM', N'227 Nguyễn Văn Cừ, Phường 4, Quận 5, TPHCM'),
('CN003', N'Chi nhánh Đà Nẵng', N'112 Phan Chu Trinh, Hải Châu, Đà Nẵng');

INSERT INTO KHACHHANG (MaKH, TenKH, SDT, DiaChi)
VALUES
('KH001', N'Nguyễn Văn An', '0901234567', N'123 Cầu Giấy, Hà Nội'),
('KH002', N'Trần Thị Bích', '0912345678', N'456 Lê Lợi, Quận 1, TPHCM'),
('KH003', N'Lê Văn Cường', '0987654321', N'789 Hùng Vương, Đà Nẵng');

INSERT INTO LOAITAIKHOAN (MaLoaiTK, TenLoaiTK, LaiSuat)
VALUES
('TT', N'Tài khoản Thanh toán', 0.1),
('TK', N'Tài khoản Tiết kiệm', 5.5);

INSERT INTO LOAIGIAODICH (MaLoaiGD, TenLoaiGD)
VALUES
('NT', N'Nạp tiền'),
('RT', N'Rút tiền'),
('CKN', N'Chuyển khoản (Nội bộ)'),
('TTHD', N'Thanh toán Hóa đơn');

INSERT INTO NHANVIENGIAODICH (MaNV, TenNV, ViTri, MaChiNhanh)
VALUES
('NV001', N'Phạm Thị Lan', N'Giao dịch viên', 'CN001'),
('NV002', N'Trịnh Văn Hùng', N'Trưởng phòng Dịch vụ', 'CN002'),
('NV003', N'Đỗ Thu Hằng', N'Giao dịch viên', 'CN001'),
('NV004', N'Nguyễn Minh Tâm', N'Giao dịch viên', 'CN002');

INSERT INTO TAIKHOAN (MaTK, SoDu, NgayMo, MaKH, MaChiNhanh, MaLoaiTK)
VALUES
('TK1001', 50000000, '2023-01-15', 'KH001', 'CN001', 'TT'),
('TK1002', 120000000, '2022-05-20', 'KH002', 'CN002', 'TT'),
('TK1003', 25000000, '2023-03-10', 'KH001', 'CN001', 'TK'),
('TK1004', 15000000, '2024-01-01', 'KH003', 'CN003', 'TT');

INSERT INTO GIAODICH (MaGiaoDich, NgayGD, SoTien, MaNV, MaTK, MaLoaiGD)
VALUES
('GD00001', '2025-10-20 09:15:00', 5000000, 'NV001', 'TK1001', 'NT'),
('GD00002', '2025-10-21 14:30:00', 2000000, 'NV004', 'TK1002', 'RT'),
('GD00003', '2025-10-22 11:00:00', 1000000, 'NV003', 'TK1003', 'NT'),
('GD00004', '2025-10-23 16:05:00', 500000, 'NV001', 'TK1001', 'RT');
GO

SELECT * FROM CHINHANH;
SELECT * FROM KHACHHANG;
SELECT * FROM NHANVIENGIAODICH;
SELECT * FROM GIAODICH;
SELECT * FROM LOAIGIAODICH;
SELECT * FROM TAIKHOAN;
SELECT * FROM LOAITAIKHOAN;
